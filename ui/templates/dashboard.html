{% extends "layout.html" %}
{% block maincontent %}
<div class="container-fluid" style="padding:70px 10px;min-height:2000px">
	<h1> Summary of Devices</h1>
	<button id="update" class="btn btn-info btn-md"><span class="glyphicon glyphicon-repeat"></span>&nbsp;Update</button>&nbsp;Last Update:<span id="updatetime"></span>
	<div class="list-group" id="list">
		<a href="#" id="plus" class="list-group-item"><span class="glyphicon glyphicon-plus"></span></a>
	</div>
</div>
<div style="display:none">
	<a href="#" id="listitem" class="list-group-item list-group-itemaction">
		<h4 class="list-group-item-heading"></h4>
		<p class="list-group-item-text"></p>
	</a>
</div>
{% endblock %}



{% block script %}
<script>
var devstaturl = "{{ url_for("devicestatus_all") }}"
$(function(){
	function update(){
		$( "#update" ).prop( "disabled", true );
		$.ajax({
			type: "get",
			url: devstaturl,
			dataType: "json",
			success: function( data ){
				var devlist = data.devices;
				var flag = false
				for( var i in devlist ){
					id = devlist[i].ID;
					if( $( "#"+id ).length ){//Update item
						$( "#"+id ).removeClass( "list-group-item-success list-group-item-warning list-group-item-danger" );
						if( devlist[i].Stat == "OK" ) $( "#"+id ).addClass( "list-group-item-success" );
						else if( devlist[i].Stat == "UP" ) $( "#"+id ).addClass( "list-group-item-warning" );
						else if( devlist[i].Stat == "NG" ) $( "#"+id ).addClass( "list-group-item-danger" );
					}else{//Append item
						var item = $( "#listitem" ).clone( true );
						var str = "list-group-item-";
						item.attr( "id", id );
						if( devlist[i].Stat == "OK" ) str += "success";
						else if( devlist[i].Stat == "UP" ) str += "warning";
						else if( devlist[i].Stat == "NG" ) str += "danger";
						item.addClass( str );
						item.children( "h4" ).append( devlist[i].Name );
						item.children( "p" ).prepend( "ID: "+devlist[i].ID+"<br/><span>"+devlist[i].Stat+"</span>" );
						$( "#list" ).append( item );
						flag = true
					}
					if( flag ) $("#plus").appendTo('#list');
				}
				$( "#updatetime" ).empty().append( data.Time );
			},
			error: function(){
				alert( "HTTP reqest fail." );
			},
			complete: function(){
				$( "#update" ).prop( "disabled", false );
			}
		});
	}
	update();
	setInterval( update, 60000 );
	$( "#update" ).click( update );
	$( "#list" ).on( "click", "a", function(){
		if( $(this).attr("id") == "plus" ){
			//プラスボタン用
			alert( "Open dialog" );
		}else{
			//それ以外用
			alert( "More Info" );
		}
	});
});
</script>
{% endblock%}



{% block style %}
<style>
.list-group>a {
	float:left;
	margin:10px;
	border-radius: 5px;
	width:100px;
	height:100px;
}   
.list-group>a#plus{
	width:48px;
	height:48px;
}
.list-group>a>p>span{
	font-size: 2em;
}
</style>
{% endblock %}



